<head>
	<style>
		body {
			background: white;
			margin: 0;
		}

		video {
			width: 100%;
			height: 100%;
			background: black;
			image-rendering: pixelated;
		}

		#label {
			text-transform: uppercase;
			font-family: monospace;
			align-content: center;
			margin: 10pt;
			height: 100%;
			text-align: center;
			width: 100%;
			position: absolute;
			z-index: -1;
		}
	</style>
</head>

<body>
	<div id="label">
		Click to Play
	</div>
	<script>
		function genElements(typeName, nums) {
			const elems = {};
			var count = 0;
			for (var c of nums) {
				if (elems[c])
					continue;
				var elem = elems[c] = document.createElement(typeName);
				switch (typeName) {
					case 'audio':
						var filePath = 'audio-' + String(c).padStart(3, '0') + '.mp3';
						break;
					case 'video':
						var filePath = 'video-' + String(c).padStart(3, '0') + '.mp4';
						elem.muted = true;
						elem.preload = true;
						break;
					default:
						return;
				}
				elem.hidden = true;
				elem.src = filePath;
				document.body.appendChild(elem);
				count++;
			}

			let result = [];
			for (var c of nums)
				result.push(elems[c]);
			return [result, nums.length];
		}

		const [elemsVideo, VIDEO_TRACK_COUNT] = genElements('video', [1, 1, 1, 3, 2, 2, 2, 3]);
		const [elemsAudio, AUDIO_TRACK_COUNT] = genElements('audio', [...Array(13).keys()]);

		async function play(elemTable, index) {
			var elem = elemTable[index];
			if (elem.readyState < 3) {
				throw new Error(`${elem.tagName} No. ${index} is not quite ready.`);
			}
			for (var e of elemTable) {
				if (e == elem)
					continue;
				e.hidden = true;
				e.pause();
			}
			elem.hidden = false;
			await elem.play();
		}

		async function playAudio(index) {
			return play(elemsAudio, index);
		}

		async function playVideo(index) {
			return play(elemsVideo, index);
		}

		var indexAudio = Math.floor(Math.random() * AUDIO_TRACK_COUNT);
		function nextAudio() {
			return playAudio(indexAudio).then(() => {
				indexAudio += 1;
				indexAudio %= AUDIO_TRACK_COUNT;
			});
		}

		var indexVideo = 0;
		function nextVideo() {
			return playVideo(indexVideo).then(() => {
				indexVideo += 1;
				indexVideo %= VIDEO_TRACK_COUNT;
			});
		}

		for (var e of elemsAudio)
			e.addEventListener("ended", nextAudio);
		for (var e of elemsVideo)
			e.addEventListener("ended", nextVideo);

		var isStarted = false;
		async function startPlayback() {
			if (isStarted)
				return;
			return Promise.all([
				nextAudio(),
				nextVideo(),
				document.body.requestFullscreen(),
			]).then(() => {
				isStarted = true;
			}).catch((m) => {
				alert(String(m));
			});
		}

		document.body.addEventListener("click", startPlayback);
		startPlayback();
	</script>
</body>