<head>
	<style>
		body {
			background: white;
			margin: 0;
		}

		video {
			width: 100%;
			height: 100%;
			background: black;
			image-rendering: pixelated;
		}

		#label {
			text-transform: uppercase;
			font-family: monospace;
			align-content: center;
			margin: 10pt;
			position: absolute;
			z-index: -1;
		}
	</style>
</head>

<body>
	<div id="label">
		Click to Play
	</div>
	<script>
		function genElements(typeName, nums) {
			const elems = [];
			var count = 0;
			for (var c of nums) {
				var elem = document.createElement(typeName);
				switch (typeName) {
					case 'audio':
						var filePath = 'audio-' + String(c).padStart(3, '0') + '.mp3';
						break;
					case 'video':
						var filePath = 'video-' + String(c).padStart(3, '0') + '.mp4';
						elem.muted = true;
						break;
					default:
						return;
				}
				elem.hidden = true;
				elem.src = filePath;
				elems.push(elem);
				document.body.appendChild(elem);
				count++;
			}
			return [elems, count];
		}

		const [elemsVideo, VIDEO_TRACK_COUNT] = genElements('video', [1, 1, 1, 0, 2, 2, 2, 0]);
		const [elemsAudio, AUDIO_TRACK_COUNT] = genElements('audio', [...Array(13).keys()]);

		async function play(elemTable, index) {
			var elem = elemTable[index];
			for (var e of elemTable)
				if (e != elem) {
					e.hidden = true;
					e.pause();
				} else {
					e.hidden = false;
					await e.play();
				}
		}

		async function playAudio(index) {
			return play(elemsAudio, index);
		}

		async function playVideo(index) {
			return play(elemsVideo, index);
		}

		var indexAudio = Math.floor(Math.random() * AUDIO_TRACK_COUNT);
		function nextAudio() {
			return playAudio(indexAudio).then(() => {
				indexAudio += 1;
				indexAudio %= AUDIO_TRACK_COUNT;
			});
		}

		var indexVideo = 0;
		function nextVideo() {
			return playVideo(indexVideo).then(() => {
				indexVideo += 1;
				indexVideo %= VIDEO_TRACK_COUNT;
			});
		}

		for (var e of elemsAudio)
			e.addEventListener("ended", nextAudio);
		for (var e of elemsVideo)
			e.addEventListener("ended", nextVideo);

		var isStarted = false;
		async function startPlayback() {
			if (isStarted)
				return;
			isStarted = true;
			await nextAudio();
			await nextVideo();
			await document.body.requestFullscreen();
		}

		document.body.addEventListener("click", startPlayback);
		startPlayback();
	</script>
</body>